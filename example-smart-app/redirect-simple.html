<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv='X-UA-Compatible' content='IE=edge' />
    <meta http-equiv='Content-Type' content='text/html; charset=utf-8' />
    <title>Example-SMART-App</title>

    <script type="text/javascript">
      function getRequestParam(name){
       if (name=(new RegExp('[?&]'+encodeURIComponent(name)+'=([^&]*)')).exec(location.search))
        return decodeURIComponent(name[1]);
      }
      
      function insertText() {
        document.getElementById('redirected_from').innerHTML = document.referrer;
        document.getElementById('redirect_url').innerHTML = window.location.href;
        document.getElementById('code').innerHTML = getRequestParam("code");
        document.getElementById('state').innerHTML = getRequestParam("state");
      }
      
      function doTokenExchange() {
        // normally this should happen automatically, but placed inside a function for demonstration purposes
        FHIR.oauth2.ready()
          .then(document.getElementById('token_reseponse').innerHTML = sessionStorage.tokenResponse)
          .then(client => client.request("Patient"))
          .then(console.log)
          .catch(console.error);
      }
    </script>
    
    <style>
      table, th, td {
        border: 1px solid black;
      }
      th, td {
        padding: 10px;
      }
    </style>
  </head>
  
  <body onload="insertText();">
    <h2>Redirect Simple</h2>

    <!-- FHIR Client JS Library -->
    <script src='./lib/js/fhir-client-v0.1.12.js'></script>
    
    <form>
      <table border="1" cellpadding="1">
        <tr>
          <td>Redirected from</td>
          <td id="redirected_from"></td>
        </tr>
        <tr>
          <td>Redirect URL</td>
          <td id="redirect_url"></td>
        </tr>
        <tr>
          <td>Code</td>
          <td id="code"></td>
        </tr>
        <tr>
          <td>State</td>
          <td id="state"></td>
        </tr>
        <tr>
          <td>Token Respones</td>
          <td id="token_response"></td>
        </tr>
      </table>
      <br/><br/>
      <input type="button" value="Proceed with Token Exchange" onclick="doTokenExchange();"/>
    </form>

  </body>
</html>
